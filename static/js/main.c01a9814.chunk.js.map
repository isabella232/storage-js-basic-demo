{"version":3,"sources":["components/LockForm.tsx","components/Welcome.tsx","components/UploadForm.tsx","App.tsx","reportWebVitals.ts","index.tsx","config.js"],"names":["DepositForm","onSubmit","type","name","onClick","e","preventDefault","Welcome","href","target","rel","UploadForm","inProgress","useState","file","setFile","id","onChange","event","files","className","undefined","App","walletConnection","api","currentUser","uploads","setUploads","uploading","setUploading","deposit","setDeposit","useEffect","hasDeposit","then","accountId","signOut","window","location","replace","origin","pathname","requestSignIn","addDeposit","catch","err","alert","message","store","request","cid","releaseDeposits","reload","map","u","navigator","clipboard","writeText","status","Status","status_code","console","warn","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ENV","process","a","nearConfig","getConfig","NODE_ENV","connect","deps","keyStore","keyStores","BrowserLocalStorageKeyStore","near","WalletConnection","init","account","contractId","getAccountId","state","amount","balance","nearInitPromise","initConnection","ReactDOM","render","document","getElementById","CONTRACT_NAME","module","exports","env","networkId","nodeUrl","contractName","walletUrl","helperUrl","keyPath","HOME","masterAccount","Error"],"mappings":"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","file":"static/js/main.c01a9814.chunk.js","sourcesContent":["import React, { ReactElement} from 'react';\n\ninterface Props {\n  onSubmit: () => void,\n}\n\nexport default function DepositForm({ onSubmit }: Props): ReactElement {\n  return (\n    <form>\n      <button type=\"button\" name=\"deposit\" onClick={(e) => {\n        e.preventDefault();\n        onSubmit();\n      }}>\n        Deposit\n      </button>\n    </form>\n  );\n}\n","import React, { ReactElement } from 'react';\n\nexport default function Welcome(): ReactElement {\n  return (\n    <div>\n      <p>\n          This app demonstrates the client-side usage of <a href=\"https://near.storage\" target=\"_blank\" rel=\"noreferrer\">the NEAR to Filecoin bridge</a>, allowing <a href=\"https://near.org\" target=\"_blank\" rel=\"noreferrer\">NEAR</a> users to store data on the <a href=\"https://filecoin.io\" target=\"_blank\" rel=\"noreferrer\">Filecoin</a> network. \n      </p>\n      <p>\n          This is version 0 of the demo app. You can deposit and release funds,\n          query for the status of a \"file\" or deal, and more. This is a beta release demo, do not store personal, encrypted, or illegal data. Data will not be available permanently on either Filecoin or IPFS. See the <a href=\"https://near.storage/terms\" target=\"_blank\" rel=\"noreferrer\">terms of service</a> before using the demo.\n      </p>\n      <p>\n          Go ahead and sign in to try it out!\n      </p>\n    </div>\n  );\n}\n","import React, { useState, ReactElement } from 'react';\n\ninterface Props {\n  inProgress: boolean\n  onSubmit: (file: File) => void;\n}\n\nexport default function UploadForm({ inProgress, onSubmit }: Props): ReactElement {\n  const [file, setFile] = useState<File>();\n  return (\n    <form>\n      <fieldset id=\"fieldset\">\n        <input type=\"file\" name=\"file\" onChange={(event) => {\n          if (event.target.files)\n            setFile(event.target.files[0]);\n        }}></input>\n        <button type=\"button\" name=\"upload\" className={inProgress===true ? \"loading\" : \"\"} onClick={(e) => {\n          e.preventDefault();\n          if (file) onSubmit(file);\n          setFile(undefined);\n        }}>\n          Upload\n        </button>\n      </fieldset>\n    </form>\n  );\n}","import 'regenerator-runtime/runtime';\nimport { useState, ReactElement, useEffect } from 'react';\nimport Form from './components/LockForm';\nimport Welcome from './components/Welcome';\nimport Upload from \"./components/UploadForm\";\nimport { Status, API, Request, requestSignIn } from \"@textile/near-storage\"\nimport { WalletConnection } from 'near-api-js';\n\ninterface Props {\n  api: API\n  currentUser?: {\n    accountId: string\n  },\n  walletConnection: WalletConnection\n}\n\nconst App = ({ walletConnection, api, currentUser }: Props): ReactElement => {\n  const [uploads, setUploads] = useState<Array<Request>>([]);\n  const [uploading, setUploading] = useState<boolean>(false);\n  const [deposit, setDeposit] = useState<boolean>(false);\n\n  useEffect(() => {\n    if (currentUser) {\n      api.hasDeposit().then(setDeposit)\n    }\n  }, [currentUser, api])\n\n  const accountId = currentUser && currentUser.accountId\n\n  const onUpload = (file: File) => {\n    setUploading(true)\n    api.store(file)\n      .then((request) => {\n        setUploads([...uploads, request])\n        setUploading(false)\n        alert(`IPFS CID:\\n${request.cid[\"/\"]}`)\n      })\n      .catch((err: Error) => {\n        setUploading(false)\n        alert(err.message)\n      });\n  }\n\n  const onStatus = (id: string) => {\n    if (id) {\n      api.status(id)\n        .then(({ request }) => {\n          alert(`Filecoin deal status: \"${Status[request.status_code]}\"!`)\n        })\n        .catch((err: Error) => alert(err.message));\n    } else {\n      console.warn(\"no 'active' file, upload a file first\")\n    }\n  }\n\n  const onSubmit = () => {\n    api.addDeposit()\n      .then(() => setDeposit(true))\n      .catch((err: Error) => alert(err.message));\n  };\n\n  const signIn = () => {\n    requestSignIn(walletConnection, {});\n  };\n\n  const signOut = () => {\n    walletConnection.signOut();\n    window.location.replace(window.location.origin + window.location.pathname);\n  };\n\n  return (\n    <main>\n      <header>\n        <h1>Textile Near Storage Demo</h1>\n        {accountId\n          ? <button onClick={signOut}>Log out</button>\n          : <button onClick={signIn}>Log in</button>\n        }\n      </header>\n      <p>\n        {deposit ? \"You got â“ƒ in here!\" : `Deposit some funds, ${accountId}!`}\n      </p>\n      {accountId\n        ? (<div>\n          <Form onSubmit={onSubmit} />\n          {deposit ? <Upload onSubmit={onUpload} inProgress={uploading} /> : null}\n          <button type=\"button\" name=\"release\" onClick={(e) => {\n            e.preventDefault();\n            api.releaseDeposits()\n              .then(() => {\n                alert(\"check your wallet in case of released funds\")\n                // Auto-refresh the page\n                window.location.reload();\n              })\n              .catch((err: Error) => alert(err.message));\n          }}>Release\n          </button>\n          <br />\n          {uploads && <h2>Your uploads</h2>}\n          {uploads.map((u: Request) => {\n            return <p>\n              {u.cid[\"/\"]}\n              <br />\n              <button type=\"button\" name=\"copy\" onClick={(e) => {\n                e.preventDefault();\n                navigator.clipboard.writeText(u.cid[\"/\"])\n              }}>\n                Copy CID\n              </button>\n              <button type=\"button\" name=\"status\" onClick={(e) => {\n                e.preventDefault();\n                onStatus(u.id);\n              }}>\n                Status\n              </button>\n              <br />\n            </p>\n          })}\n        </div>\n        ) : <Welcome />\n      }\n    </main>\n  );\n};\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","/// <reference lib=\"dom\" />\n\nimport App from \"./App\"\nimport ReactDOM from 'react-dom';\nimport getConfig from './config.js';\nimport { connect, keyStores, WalletConnection } from 'near-api-js';\nimport { init } from \"@textile/near-storage\"\nimport reportWebVitals from './reportWebVitals';\nimport \"./index.scss\"\n\n// Seems like a strange hack\nconst ENV = process.env as unknown as Record<string, string>\n\ndeclare global {\n  interface Window {\n    nearInitPromise: Promise<void>\n  }\n}\n\n// Initializing contract\nasync function initConnection() {\n  const nearConfig = getConfig(ENV.NODE_ENV as any || 'testnet');\n\n  // Initializing connection to the NEAR TestNet\n  const near = await connect({\n    deps: {\n      keyStore: new keyStores.BrowserLocalStorageKeyStore()\n    },\n    ...nearConfig\n  });\n\n  // Needed to access wallet\n  const walletConnection = new WalletConnection(near, null);\n\n  const api = await init(walletConnection.account(), { contractId: 'filecoin-bridge.testnet' })\n\n  // Load in account data\n  let currentUser;\n  if (walletConnection.getAccountId()) {\n    currentUser = {\n      accountId: walletConnection.getAccountId(),\n      balance: (await walletConnection.account().state()).amount\n    };\n  }\n\n  return { currentUser, api, walletConnection }\n}\n\nwindow.nearInitPromise = initConnection()\n  .then(({ api, currentUser, walletConnection }) => {\n    ReactDOM.render(\n      <App\n        api={api}\n        walletConnection={walletConnection}\n        currentUser={currentUser}\n      />,\n      document.getElementById('root')\n    );\n  });\n\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","// Seems like a strange hack\nconst ENV = process.env\nconst CONTRACT_NAME = ENV.CONTRACT_NAME || 'filecoin-bridge.testnet';\n\n/**\n * \n * @param {\"mainnet\" | \"production\" | \"development\" | \"testnet\" | \"betanet\" | \"local\" | \"test\" | \"ci\" | \"ci-betanet\"} env \n * @returns \n */\nfunction getConfig(env) {\n  switch(env) {\n    case 'mainnet':\n      return {\n        networkId: 'mainnet',\n        nodeUrl: 'https://rpc.mainnet.near.org',\n        contractName: CONTRACT_NAME,\n        walletUrl: 'https://wallet.near.org',\n        helperUrl: 'https://helper.mainnet.near.org'\n      };\n    // This is an example app so production is set to testnet.\n    // You can move production to mainnet if that is applicable.\n    case 'production':\n    case 'development':\n    case 'testnet':\n      return {\n        networkId: 'testnet',\n        nodeUrl: 'https://rpc.testnet.near.org',\n        contractName: CONTRACT_NAME,\n        walletUrl: 'https://wallet.testnet.near.org',\n        helperUrl: 'https://helper.testnet.near.org'\n      };\n    case 'betanet':\n      return {\n        networkId: 'betanet',\n        nodeUrl: 'https://rpc.betanet.near.org',\n        contractName: CONTRACT_NAME,\n        walletUrl: 'https://wallet.betanet.near.org',\n        helperUrl: 'https://helper.betanet.near.org'\n      };\n    case 'local':\n      return {\n        networkId: 'local',\n        nodeUrl: 'http://localhost:3030',\n        keyPath: `${ENV.HOME}/.near/validator_key.json`,\n        walletUrl: 'http://localhost:4000/wallet',\n        contractName: CONTRACT_NAME\n      };\n    case 'test':\n    case 'ci':\n      return {\n        networkId: 'shared-test',\n        nodeUrl: 'https://rpc.ci-testnet.near.org',\n        contractName: CONTRACT_NAME,\n        masterAccount: 'test.near'\n      };\n    case 'ci-betanet':\n      return {\n        networkId: 'shared-test-staging',\n        nodeUrl: 'https://rpc.ci-betanet.near.org',\n        contractName: CONTRACT_NAME,\n        masterAccount: 'test.near'\n      };\n    default:\n      throw Error(`Misconfigured environment '${env}'. Can be configured in src/config.js.`);\n  }\n}\n\nmodule.exports = getConfig"],"sourceRoot":""}